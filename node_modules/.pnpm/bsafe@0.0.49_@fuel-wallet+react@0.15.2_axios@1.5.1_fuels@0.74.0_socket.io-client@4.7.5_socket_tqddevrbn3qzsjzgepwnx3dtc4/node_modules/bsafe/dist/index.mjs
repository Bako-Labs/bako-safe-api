import { Wallet, bn, arrayify, Provider, Address, ZeroBytes32, Predicate, Signer, hashMessage, ScriptTransactionRequest, InputType, hexlify, transactionRequestify, TransactionResponse, FuelConnector, FuelConnectorEventTypes } from 'fuels';
import G from 'axios';
import { v4 } from 'uuid';
import { io } from 'socket.io-client';

var r={BSAFE_URL:"https://app.bsafe.pro",API_URL:"https://api-multsig.infinitybase.com",REFETCH_TIMEOUT:"10000",ENCODER:"fuel",GAS_PRICE:"1",GAS_LIMIT:"10000",PROVIDER:"https://beta-5.fuel.network/graphql"};var n0={types:[{typeId:0,type:"[_; 10]",components:[{name:"__array_element",type:1,typeArguments:null}],typeParameters:null},{typeId:1,type:"b256",components:null,typeParameters:null},{typeId:2,type:"bool",components:null,typeParameters:null},{typeId:3,type:"u64",components:null,typeParameters:null}],functions:[{inputs:[],name:"main",output:{name:"",type:2,typeArguments:null},attributes:null}],loggedTypes:[],messagesTypes:[],configurables:[{name:"SIGNERS",configurableType:{name:"",type:0,typeArguments:null},offset:5012},{name:"SIGNATURES_COUNT",configurableType:{name:"",type:3,typeArguments:null},offset:4996},{name:"HASH_PREDICATE",configurableType:{name:"",type:1,typeArguments:null},offset:4964}]},i0="0x740000034700000000000000000012fc5dfcc00110fff3001aec500091000f781a4000005d47f00a264400001a6870005047b87072480020284504805d43f00a286914005d43f00b264000001a6070001a6c00001a5000005d67f00b5d43f00a1641b400764002d16140000113450000764400061341004076400001360000005043ba901a401000740000025043ba901a400000134500007644000613410040764000025d43f00c36400000615c010574000001615c00075043bb785d47f03f1045130072480020284114805047bbd85d4bf03f10492300724c0020284524c0a1410460134100001a5800001a540000764002ad164165c0764000065d43f01115415400764000025d43f0111341540024400000614d64015043b6d072440090284134405d43b0da13410000764000e9614164015047b9501ae900001ae5100020f8330058fbe00250fbe0047400037e1a43d0005047be807248004028450480506bbe801a400000264000001a6c7000134140001a70000076400020134000007640001a107005001541c0007640000174000008267000001a4470001540000076400001740000021a4000002845b4001a6d10001a48000016412500764000031a400000264000007400000c1a4000001041b40010410480104584805c4510005e411000104920407500000b1a400000264000001a7140001a6d80005d43f040104103005d47f04010451300504bbe60724c0020284904c05043be604241b700504bbed0724c0020284904c05043bed0724800201b480480104bb480724c0020284914c0724800201b481480104bb480724c0020284914c05047b420724800402847b480504bbe00724c0040284914c05047be00504bb040724c00402849a4c0504fb6b072680020284d06803e4524c01a408000134100407640000a5043b5e85fec00bd5047be0050490008724c0040284914c0504bbae07244004828490440740000065043b3d85fec107b5fec0083504bbae072440048284904405043bd3872440048284124405043b76072440048284124405d43b15c13410040764000365043bd385047b81872480048284504805d43b1a71341000076400001360000005043b818504100085047bce872480040284504805043bce8724400201b440440104504405043bce8724800201b481480104904805043b4a0724c0020284114c050450020724c0020284524c05047ba4072480040284504805043b9b01ae910001ae5000020f8330058fbe00250fbe004740003061a43d0005047bc3872480020284504805043b5685fec00ad5047bc38504bb0c0724c0020284914c050450008724c0020284524c0504bbb2872440028284904407400000a5043b760504100405047b3a05fec107450491020724c0008284904c0504bbb2872400028284914005d43f041104103005047b7a8724c0028284524c05d47b16513451000504fbb5072480020284d048076440001740000095043b7a8504100085047bd8072480020284504805043bd80504fbb5072440020284d04405043be4072440020284134405043be401a6c00005d47f0121645b4401a48000076440001740000135047b2605d4bf04210492300724c0140284524c0724800201b49b480104914805047bbb8724c0020284504c0504fbc1872680020284d2680a14514e01a48100076440002106db04075000016105554805043bb70740001b35043b6d0504100085047bef072480088284504805d43f03b104134005d47b1e6504bb8b01ae900001ae510001ae1200020f8330058fbe00250fbe004740002031a47d000504bbd28724c0010284914c05047bd28504bb630724c0010284914c05d692001504bb640724c0010284914c05d6d20005d47b1e61b441440104504405d4bb1e7504fb8c01ae910001ae520001ae1300020f8330058fbe00250fbe004740001ea1a47d000504bbec0724c0010284914c05047bec0504bb650724c0010284914c05d712001504bb660724c0010284914c05d7520005d47b1e61b441440104104405d47b1e71b441440104104405d47b1e8504bb8d01ae900001ae510001ae1200020f8330058fbe00250fbe004740001ce1a43d0005047bc5872480010284504805043bc585047b67072480010284504805d7910015047b68072480010284504805d7d10005043b9201ae9000020f8330058fbe00250fbe0047400022b1a43d0005d8100005d4500015d8500021341a00076400021134210007640001a10421680154904407648000174000007264000001a487000154d1000764c000174000001284a04401a8120001a4c000016453680764400051a440000264400001a8500001a4500007400000c10460840104514c01049b4c05c4920005e452000104d30407500000c1a400000264000001a85a0001a45a0001a81b0001341400076400021134210007640001a10421500154904407648000174000007264000001a487000154d1000764c000174000001284a04401a8120001a4c000016453500764400051a440000264400001a8500001a4500007400000c10460840104514c0104984c05c4920005e452000104d30407500000c1a400000264000001a8540001a4590001a8180001341c00076400021134210007640001a10421700154904407648000174000007264000001a487000154d1000764c000174000001284a04401a8120001a4c000016453700764400051a440000264400001a8500001a4500007400000c10460840104514c01049d4c05c4920005e452000104d30407500000c1a400000264000001a85c0001a45c0001a81d0005043b9d05fee013a5fed113b5fee113c5047b8e01ae900001ae5100020f8330058fbe00250fbe004740001611a43d0005047bc6872480020284504805043b9381ae9000020f8330058fbe00250fbe004740001a91a43d0005d6900005d7100015d6d00021341e000764000211341b0007640001a1041b780154507007644000174000007264000001a4470001549c00076480001740000012845a7001a6910001a4c000016453780764400051a440000264400001a6d00001a7100007400000c1045a6c0104514c01049f4c05c4920005e452000104d30407500000c1a400000264000001a6de0001a71e0001a69f0005043bc685d47f00a264400001a447000504bb890724c0020284904c05d43f00a284524005d43f00a13410000764000231341b0007640001c5d43f00a1041b400154907007648000174000007264000001a487000154dc000764c0001740000012849a7001a6920001a7000005d4bf00a1649c480764800051a440000264400001a6d00001a7100007400000c1049a6c010492700104d17005c4d30005e4930001071c0407500000d1a400000264000005d6ff00a5d73f00a1a6910005d43f040104103005047b9e85feda13d5fedc13e5fedb13f504bb9001ae910001ae5200020f8330058fbe00250fbe004740000f41a47d000504bbc88724c0020284914c05047bef0504bbc88504fb080726800201b68068010693680726c0020286906c0726800201b68168010693680726c0020286906c05043b4607268004028413680504fbdc072680040284d06805043bdc0504fb0e072680040284d16805047b69072680020284526803f4134401a408000134100407640000a5043b5a05fec00b45047bdc050490008724c0040284914c0504bba987244004828490440740000065043b4e05fec109c5fec00a4504bba9872440048284904405043b7d072440048284124405d43b1531341000076400001360000005043b7d0504100085047bca872480040284504805043bca8724400201b440440104504405043bca8724800201b481480104904805043b528724c0020284114c050450020724c0020284524c05047ba0072480040284504805043b9901ae910001ae5000020f8330058fbe00250fbe004740001231a43d0005047bda072480020284504805043bda01a6c00005d47f0121645b4401a48000076440001740000135047b1205d4bf04210492300724c0140284524c0724800201b49b480104914805047bb98724c0020284504c0504fbbf872680020284d2680a14514e01a48100076440002106db04075000016105554805043bb7010596040750002ab240000005d43f00a164106c0764000025d43f00a134106c07640000a1041a6c05047b5905fec10b25c4100005049100f5e490000504bba807240001028491400740000055043b3c85fec0079504bba8072440010284904405043b86072440010284124405d43b1501341004076400001360000005043b8605041000f5c4100005d47f043104513005d4bf03c1f490480724c00011b4924c0104914805c452000134946407648000174000010134990001a4c1000764800025d4bf03d1b4d2640154936407648000174000007264c00001a487000155590007654000174000001284986401a6120001a653000104985005e491000104540405d4bf043104923005c4ff1f0114104c0724c00011b4104c0104124005c410000134916407648000174000010134990001a4c1000764800025d4bf03d1b4d2640154936407648000174000007264c00001a487000155190007650000174000001284986401a6120001a653000104984405e49000010511040106db0407500032f1af05000910000285ff100005ff110015ff120025ff130035ff3b0041aec5000910000101a43a0001a4790001a4b80001a4fe0001b4510405fed00005fed10011a43b00072440010284904401af52000920000101af9300059f050285d43c0005d47c0015d4bc0025d4fc0035defc004920000284af800001af05000910000505ff100005ff110015ff120025ff130035ff140045ff150055ff160065ff170075ff180085ff3b0091aec5000910000201a43a0001a4790001a4be0001a4c0000264c00001a4c70005d5100005d5500025d410002134100001a58000076400020134000007640001a10580540154160007640000174000008265800001a407000155c0000765c0001740000021a5c0000284135c01a4d00001a60000016418540764000031a400000264000007400000c1a4000001041340010410600105d46005c5d70005e417000106180407500000b1a400000264000001a5950001a4d40005d43f040104103007250002028ed05001a43b00042413580724c0020284504c01af51000920000201af9200059f050505d43c0005d47c0015d4bc0025d4fc0035d53c0045d57c0055d5bc0065d5fc0075d63c0085defc009920000504af800001af05000910000205ff100005ff110015ff120025ff3b0031aec5000910000001a43a0001a47e0001a480000264800001a4870005f4120005f4000015f4000021af50000920000001af9100059f050205d43c0005d47c0015d4bc0025defc003920000204af800001af05000910000285ff100005ff110015ff120025ff130035ff3b0041aec5000910000001a43a0001a4790001a4be000724c0040284504c01af51000920000001af9200059f050285d43c0005d47c0015d4bc0025d4fc0035defc004920000284af800001af05000910000385ff100005ff110015ff120025ff130035ff140045ff150055ff3b0061aec5000910000781a43a0001a4b90001a4fe0005d47f040104513001a500000265000001a5070005fed40085fec00095fec000a5053b0407254004028ed05401aebb0001ae5400020f8330058fbe00250fbe004740000165043b05872500020284115005053b0585d43b0085d47b00a4251044072400020284944001af52000920000781af9300059f050385d43c0005d47c0015d4bc0025d4fc0035d53c0045d57c0055defc006920000384af800001af05000910000585ff100005ff110015ff120025ff130035ff140045ff150055ff160065ff170075ff180085ff190095ff3b00a1aec5000910000401a43a0001a6790001a63e0005d47f00a264400001a4470007248002028ed04801a4bb0005d4d20005d5120015d5520025d4920035f4530005f4540015f4550025f4520035d4bf00a134920007648002c5d49900213492000764800225d4990025d4ff00a104924c05d4d90025d5190005d559001155925407658000174000007264800001a587000155d5000765c000174000001285945401a5160005f6540001a5800005d53f00a16516500765000055f6520015f6520021a440000264400007400000f5d519000105144c010514580105515805c5550005e515000105960407500000e5f6510005d47f00a5f6510015d47f00a5f6510021a44000026440000504100205d47f00a264400001a447000504bb020724c0020284904c05d4120005d4d20015d5120025d4920035f4500005f4530015f4540025f4520035d43f00a134100007640002c5d41900213410000764000225d4190025d4bf00a104104805d4990025d4d90005d519001155505007654000174000007264000001a547000155940007658000174000001285535001a4d50005f6530001a5400005d4ff00a164d54c0764c00055f6500015f6500021a400000264000007400000f5d4d9000104d3480104d3540105115405c5140005e4d4000105550407500000e5f6510005d43f00a5f6500015d43f00a5f6500021a400000264000001af40000920000401af9800059f050585d43c0005d47c0015d4bc0025d4fc0035d53c0045d57c0055d5bc0065d5fc0075d63c0085d67c0095defc00a920000584af8000047000000111111111111111111111111111111111111111111111111111111111111111100000000000000000000000000000000000000000000000000000000000000003031323334353637383961626364656600000000000000200000000000000040cccccccccccc000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060000000000000000400000000000000020f000000000000000000000000001364000000000000131c00000000000012fc0000000000001394000000000000133c",R=class R{static createInstance(e,t){let{abi:s,bin:n}=R;return new Predicate(n,e,s,t)}};R.abi=n0,R.bin=i0;var E=R;var {PROVIDER:o0,API_URL:c0,BSAFE_URL:d0,ENCODER:f0,GAS_PRICE:u0,GAS_LIMIT:p0,REFETCH_TIMEOUT:b0}=r,T={PROVIDER:o0,API_URL:c0,BSAFE_URL:d0,ENCODER:f0,GAS_PRICE:u0,GAS_LIMIT:p0,REFETCH_TIMEOUT:b0},m0={setup:a=>{Object.keys(a).forEach(t=>{t in T&&(T[t]=a[t]);});}};var k=class a{constructor(e){this.client=G.create({baseURL:T.API_URL}),this.payloadSession=e;}static async create(e,t){let{data:s}=await G.create({baseURL:T.API_URL}).post("/user",{address:e,provider:t});return new a({address:e,hash:v4(),createdAt:new Date().toISOString(),provider:t,encoder:"fuel",user_id:s.id})}async createSession(){if(!this.signature)throw new Error("Signature not found");let{address:e}=this.payloadSession,{data:t}=await this.client.post("/auth/sign-in",{...this.payloadSession,signature:this.signature}),s={address:e,token:t.accessToken};return this.client.defaults.headers.common.Authorization=t.accessToken,this.client.defaults.headers.common.Signeraddress=e,this.BSAFEAuth=s,s}async signerByPk(e){let s=await Wallet.fromPrivateKey(e,await Provider.create(T.PROVIDER)).signMessage(JSON.stringify(this.payloadSession));this.signature=s;}async signerByAccount(e){let t=await e.signMessage(JSON.stringify(this.payloadSession));this.signature=t;}async signTransaction(e,t,s){let{data:n}=await this.client.get(`/transaction/${t}`),i=await e.signMessage(n.hash);await this.client.put(`/transaction/signer/${t}`,{account:e.address.toString(),signer:i,confirm:s??!0}).then(()=>!0).catch(()=>!1);}};var y=class{constructor(e){this.client=G.create({baseURL:T.API_URL,headers:{Authorization:e.token,Signeraddress:e.address}});}};var P=class extends y{constructor(e){super(e);}async create(e){try{let{data:t}=await this.client.post("/transaction",e);return t}catch{throw new Error("ERRO AO CRIAR")}}async findByHash(e){let{data:t}=await this.client.get(`/transaction/by-hash/${e}`);return t}async findByTransactionID(e){let{data:t}=await this.client.get(`/transaction/${e}`);return t}async sign(e,t,s,n){let{data:i}=await this.client.put(`/transaction/signer/${e}`,{account:t,signer:s,confirm:n??!0});return i}async send(e){let{data:t}=await this.client.post(`/transaction/send/${e}`);return t}async verify(e){let{data:t}=await this.client.post(`/transaction/verify/${e}`);return t}};var h0=(t=>(t.ASC="ASC",t.DESC="DESC",t))(h0||{}),L=(d=>(d.AWAIT_REQUIREMENTS="await_requirements",d.PENDING_SENDER="pending_sender",d.PROCESS_ON_CHAIN="process_on_chain",d.SUCCESS="success",d.DECLINED="declined",d.FAILED="failed",d))(L||{}),T0=(s=>(s.REJECTED="REJECTED",s.DONE="DONE",s.PENDING="PENDING",s))(T0||{}),S0=(n=>(n.SUCCESS="SuccessStatus",n.SQUIZED="SqueezedOutStatus",n.SUBMITED="SubmittedStatus",n.FAILED="FailureStatus",n))(S0||{});var B=class extends y{constructor(e){super(e);}async create(e){let{data:t}=await this.client.post("/predicate",e);return t}async findByAddress(e){let{data:t}=await this.client.get(`/predicate/by-address/${e}`);return t}async findById(e){let{data:t}=await this.client.get(`/predicate/${e}`);return t}async hasReservedCoins(e){let{data:t}=await this.client.get(`/predicate/reserved-coins/${e}`);return t}async listPredicateTransactions(e){let{data:t}=await this.client.get("/transaction",{params:{...e}});return t}};var H=(t=>(t.REQUIRED_AUTH="Required credentials",t.INVALID_PARAMETER="Invalid instance parameters",t))(H||{});var v={FULL:{account:"0x94ffcc53b892684acefaebc8a3d4a595e528a8cf664eeb3ef36f1020b0809d0d",address:"fuel1jnluc5acjf5y4nh6a0y28499jhjj32x0ve8wk0hndugzpvyqn5xsfsfzly",privateKey:"0xa449b1ffee0e2205fa924c6740cc48b3b473aa28587df6dab12abc245d1f5298"},STORE:{account:"0x53de37ae51fcfecb17ee3589f68904ac75bf5ec109edeb1065ccb63145287da6",address:"fuel1200r0tj3lnlvk9lwxkyldzgy436m7hkpp8k7kyr9ejmrz3fg0knqndhwm6",privateKey:"0x61a006b78a6e9eb5aeb11df25e6444be281893875ae5fdc5fa4a0f4702995cb7"},USER_1:{account:"0x92dffc873b56f219329ed03bb69bebe8c3d8b041088574882f7a6404f02e2f28",address:"fuel1jt0lepem2mepjv576qamdxltarpa3vzppzzhfzp00fjqfupw9u5q9gyphu",privateKey:"0xa349d39f614a3085b7f7f8cef63fd5189136924fc1238e6d25ccdaa43a901cd0"},USER_2:{account:"0x456bdaffaf74fe03521754ac445d148033c0c6acf7d593132c43f92fdbc7324c",address:"fuel1g44a4la0wnlqx5sh2jkyghg5sqeup34v7l2exyevg0ujlk78xfxqr6ywcm",privateKey:"0x139f2cd8db62a9d64c3ed4cdc804f1fb53be98d750cd1432a308b34a42d8dcc7"},USER_3:{account:"0x639880ece7753a32e09164d14dad7436c57737e567f18b98f6ee30fec6b247ec",address:"fuel1vwvgpm88w5ar9cy3vng5mtt5xmzhwdl9vlcchx8kacc0a34jglkqjnvpjz",privateKey:"0x40aaca08dac67fa0c22b51794f652e20173970cd05a8797f2d3e8393cfc44211"},USER_4:{account:"0xfd8c520ef8caff0ad3289aa64acecd4ef86ac8f643fd9b76bf2d163a86a66716",address:"fuel1lkx9yrhcetls45egn2ny4nkdfmux4j8kg07eka4l95tr4p4xvutqmvhl2l",privateKey:"0xb58ad4fb072290d03fc2d81cd7534e9bf7360ccad8a48d2799b60bab357255da"},USER_5:{account:"0x8247104854dd733cb475901d55047f57cb3c8cafe3a9f7233de3325b8bf56a5c",address:"fuel1sfr3qjz5m4enedr4jqw42prl2l9ner90uw5lwgeauve9hzl4dfwqxhyn83",privateKey:"0x4256a670740031e4e7cb7216c9fe8921a4485c187686b7ab0ae7c317d7de0a22"}};var I={ETH:"0x0000000000000000000000000000000000000000000000000000000000000000",DAI:"0x0d9be25f6bef5c945ce44db64b33da9235fbf1a9f690298698d899ad550abae1",sETH:"0x1bdeed96ee1e5eca0bd1d7eeeb51d03b0202c1faf764fec1b276ba27d5d61d89"};var q=a=>new Promise(e=>setTimeout(e,a));var{PROVIDER:y0}=r,F=class extends Provider{constructor(){super(y0);}};Wallet.fromPrivateKey(v.FULL.privateKey,new F);var {GAS_PRICE:R0,GAS_LIMIT:P0}=r;({gasPrice:bn(R0),gasLimit:bn(P0)});var M={signature:"0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",address:"0x0000000000000000000000000000000000000000000000000000000000000000"},W=()=>Address.fromRandom().toB256(),j=a=>{let e=Array(10).fill(ZeroBytes32);return a.forEach((t,s)=>{e[s]=Address.fromString(t).toB256();}),e};var _=class{static hex2string(e){return e.filter(t=>t!=I.ETH).map(t=>Address.fromB256(t).toString())}};var O=class a extends Predicate{constructor({configurable:e,provider:t,abi:s,bytecode:n,name:i,description:d,BSAFEVaultId:u,BSAFEVault:g,BSAFEAuth:S,transactionRecursiveTimeout:A}){let f=s?JSON.parse(s):E.abi,p=n||E.bin,b=e.network,l=e.chainId;a.validations(e);let h=a.makePredicate(e);super(arrayify(p),t,f,h),this.bin=p,this.abi=f,this.configurable=this.configurable={HASH_PREDICATE:h.HASH_PREDICATE,SIGNATURES_COUNT:h.SIGNATURES_COUNT,SIGNERS:h.SIGNERS,network:b,chainId:l},this.provider=t,this.name=i||`Random Vault Name - ${v4()}`,this.description=d||void 0,this.BSAFEVaultId=u,this.transactionRecursiveTimeout=A||1e3,this.BSAFEVault=g,this.auth=S;}static validations(e){let{SIGNATURES_COUNT:t,SIGNERS:s}=e;if(!t||Number(t)==0)throw new Error("SIGNATURES_COUNT is required must be granter than zero");if(!s||s.length===0)throw new Error("SIGNERS must be greater than zero");if(s.length<Number(t))throw new Error("Required Signers must be less than signers")}static async create(e){let t=("predicateAddress"in e||"id"in e)&&"address"in e&&"token"in e,s="configurable"in e&&"provider";if(t){let{id:n,predicateAddress:i,token:d,address:u}=e,g="id"in e&&n;if(i==null&&n==null)throw new Error("predicateAddress or BSAFEPredicateId is required");let S=new B({address:u,token:d}),A=g?await S.findById(n):await S.findByAddress(i);if(!A)throw new Error("BSAFEVault not found");let{configurable:f,abi:p,bytes:b,name:l,description:h,id:m,provider:a0}=A,U=new a({configurable:JSON.parse(f),provider:await Provider.create(a0),abi:p,bytecode:b,name:l,description:h,BSAFEVaultId:m,BSAFEVault:A});return U.api=S,U.auth={address:u,token:d},U}else if(s){let{configurable:n,provider:i,name:d,description:u,abi:g,bytecode:S,BSAFEAuth:A,BSAFEVaultId:f}=e,p=new a({configurable:n,provider:i,abi:g,bytecode:S,name:d,description:u,BSAFEAuth:A,BSAFEVaultId:f});if(A){let b=A;p.auth=b,p.api=new B(b),await p.createOnService();}return p}else throw new Error("Required props to instance a vault")}verifyAuth(){if(!this.auth)throw new Error("Auth is required")}async createOnService(){this.verifyAuth();let{id:e,...t}=await this.api.create({name:this.name,description:this.description,predicateAddress:this.address.toString(),minSigners:this.configurable.SIGNATURES_COUNT,addresses:_.hex2string(this.configurable.SIGNERS),bytes:this.bin,abi:JSON.stringify(this.abi),configurable:JSON.stringify(this.configurable),provider:this.provider.url});this.BSAFEVault={...t,id:e},this.BSAFEVaultId=e;}static makePredicate(e){return {SIGNATURES_COUNT:e.SIGNATURES_COUNT,SIGNERS:j(e.SIGNERS),HASH_PREDICATE:e.HASH_PREDICATE??W()}}async BSAFEIncludeTransaction(e){return C.instance({auth:this.auth,vault:this,transfer:e,isSave:!0})}async BSAFEGetTransactions(e){this.verifyAuth();let t=await this.api.listPredicateTransactions({predicateId:[this.BSAFEVaultId],...e});return Promise.all(t.map(s=>({resume:s.resume,witnesses:s.witnesses})))}async BSAFEGetTransaction(e){return C.instance({vault:this,auth:this.auth,transfer:e})}getAbi(){return this.abi}getBin(){return this.bin}getConfigurable(){return this.configurable}};var K=arrayify("0x9000000447000000000000000000003c5dfcc00110fff3001a485000910000201a440000724000202849140072400020340004902400000047000000");function ms(a,e){if(e=="0x")return;let t=Signer.recoverAddress(hashMessage(e),a);return t?t.toString():M.address}var {GAS_LIMIT:q0,GAS_PRICE:V0}=r,D=class extends ScriptTransactionRequest{constructor({script:e,gasLimit:t,gasPrice:s}={script:K,gasPrice:bn(V0),gasLimit:bn(q0)}){super({gasPrice:s,gasLimit:t,script:e});}async instanceTransaction(e,t,s,n){Object.entries(s).map(([,i])=>{this.addCoinOutput(Address.fromString(i.to),i.amount,i.assetId);}),this.addResources(e),this.inputs?.forEach(i=>{i.type===InputType.Coin&&hexlify(i.owner)===t.address.toB256()&&(i.predicate=arrayify(t.bytes),i.predicateData=arrayify(t.predicateData));}),n&&(this.witnesses=[...this.witnesses,...n]);}};var x=class{static async assetsGroupById(e){return e.reduce((t,s)=>{let{assetId:n,amount:i}=s;return t[n]?t[n]=t[n].add(bn.parseUnits(i)):t[n]=bn.parseUnits(i),t},{})}static async assetsGroupByTo(e){return e.reduce((t,s)=>{let{to:n,amount:i,assetId:d}=s,u=`${n}${d}`;return t[u]?t[u].amount.add(bn.parseUnits(i)):t[u]={assetId:d,amount:bn.parseUnits(i),to:n},t},{})}static async addTransactionFee(e,t){let s=e;if(!!s[I.ETH]){let i=bn(t).add(s[I.ETH]);s[I.ETH]=i;}else s[I.ETH]=bn().add(t);return Object.entries(s).map(([i,d])=>({amount:d,assetId:i}))}static includeSpecificAmount(e,t){return t.map(s=>{let n=e.find(i=>i);return n?{...s,utxo:n.id}:{...s,onPredicate:"",utxo:""}})}};var ks=[{name:"Etherum",slug:"ETH",assetId:I.ETH},{name:"Dai",slug:"DAI",assetId:I.DAI},{name:"sEther",slug:"sETH",assetId:I.sETH}];var {GAS_PRICE:j0}=r,C=class a{constructor({vault:e,name:t,witnesses:s,transactionRequest:n,BSAFEScript:i,service:d,BSAFETransaction:u,BSAFETransactionId:g}){this.name=t,this.vault=e,this.service=d,this.witnesses=s,this.BSAFEScript=i,this.transactionRequest=n,this.BSAFETransaction=u,this.BSAFETransactionId=g;}static async instance({transfer:e,auth:t,vault:s,isSave:n}){let i=(f,p)=>transactionRequestify(f).getTransactionId(p).slice(2),d=t&&new P(t),u=`Random Vault Name - ${v4()}`;if(typeof e=="string"){if(!t||!d)throw new Error("Required credentials");let f=e.length<=36?await d.findByTransactionID(e):await d.findByHash(e),p=await a.formatTransaction({name:f.name,vault:s,assets:f.assets,witnesses:f.witnesses.map(b=>b.signature).filter(b=>!!b)});return new a({vault:s,service:d,name:f.name,BSAFEScript:p,transactionRequest:transactionRequestify(p),witnesses:f.witnesses.map(b=>b.account),BSAFETransactionId:f.id,BSAFETransaction:f})}if(e&&Object.entries(e).length<=3&&Object.entries(e).length>0&&"assets"in e&&!!s){let f=e.assets.map(m=>({assetId:m.assetId,amount:m.amount.toString(),to:m.to})),p=await a.formatTransaction({name:e.name?e.name:`Random Vault Name - ${v4()}`,vault:s,assets:f}),b=transactionRequestify(p),l=i(b,s.provider.getChainId()),h=t&&d&&await d.create({assets:f.map(m=>({...m,utxo:""})),hash:l,txData:b,name:e.name??u,status:"await_requirements",predicateAddress:s.address.toString()});return new a({vault:s,service:d,BSAFETransaction:h,name:e.name??u,transactionRequest:b,BSAFEScript:p,witnesses:[],BSAFETransactionId:h?.id})}if(e&&Object.entries(e).length>3&&"type"in e){s.populateTransactionPredicateData(e);let f=transactionRequestify(e),p=i(f,s.provider.getChainId()),b=f.getCoinOutputs().map(m=>({assetId:m.assetId.toString(),to:m.to.toString(),amount:bn(m.amount).format().toString(),utxo:""})),l;t&&d&&n&&(l=await d.create({assets:b,hash:p,txData:f,name:u,status:"await_requirements",predicateAddress:s.address.toString()}));let h=l&&l.witnesses?l.witnesses.map(m=>m.signature).filter(m=>!!m):[];return new a({vault:s,service:d,witnesses:h,name:u,transactionRequest:f,BSAFEScript:new ScriptTransactionRequest,BSAFETransaction:l,BSAFETransactionId:l?.id})}throw new Error("Invalid instance parameters")}makeBlockUrl(e){return e?`https://fuellabs.github.io/block-explorer-v2/transaction/${this.getHashTxId()}?providerUrl=${encodeURIComponent(this.vault.provider.url)}`:""}getHashTxId(){return this.transactionRequest.getTransactionId(this.vault.provider.getChainId()).slice(2)}static async formatTransaction({vault:e,assets:t,witnesses:s}){let n=await x.assetsGroupByTo(t),i=await x.assetsGroupById(t),d=await x.addTransactionFee(i,bn(j0)),u=await e.getResourcesToSpend(d),g=new D;return await g.instanceTransaction(u,e,n,s),g}async send(){if(!this.service){let e=transactionRequestify(this.BSAFEScript),t=await this.vault.provider.estimatePredicates(e),s=hexlify(t.toTransactionBytes()),{submit:{id:n}}=await this.vault.provider.operations.submit({encodedTransaction:s});return new TransactionResponse(n,this.vault.provider)}switch(this.BSAFETransaction=await this.service.findByTransactionID(this.BSAFETransactionId),this.BSAFETransaction.status){case"pending_sender":await this.service.send(this.BSAFETransactionId);break;case"process_on_chain":return await this.wait();}return {...this.BSAFETransaction.resume,bsafeID:this.BSAFETransactionId}}async wait(){if(!this.service)throw Error("Implement this.");let e=await this.service.findByTransactionID(this.BSAFETransactionId);for(;e.status!=="success"&&e.status!=="failed";)await q(this.vault.transactionRecursiveTimeout),e=await this.service.findByTransactionID(this.BSAFETransactionId),e.status=="pending_sender"&&await this.send(),e.status=="process_on_chain"&&await this.service.verify(this.BSAFETransactionId);return {...e.resume,status:e.status}}};var e0={API_URL:"https://api-multsig.infinitybase.com",APP_NAME:"Bako Safe",APP_BSAFE_URL:"https://safe.bako.global",APP_IMAGE_DARK:"https://safe.bako.global/assets/bakoLogoWhite-3f5ae691.svg",APP_DESCRIPTION:"Bako Safe is a connector to safe.bako.global, a non-custodial vault for your crypto assets.",APP_IMAGE_LIGHT:"https://safe.bako.global/assets/bakoLogoWhite-3f5ae691.svg"},t0=(a=>(a.ACCOUNTS="accounts",a.CURRENT_ACCOUNT="currentAccount",a.TRANSACTION_CREATED="[TRANSACTION_CREATED]",a.TRANSACTION_SEND="[TRANSACTION_SEND]",a.AUTH_CONFIRMED="[AUTH_CONFIRMED]",a.AUTH_REJECTED="[AUTH_REJECTED]",a.AUTH_DISCONECT_DAPP="[AUTH_DISCONECT_DAPP]",a.AUTH_DISCONECT_CONFIRM="[AUTH_DISCONECT_CONFIRM]",a.CONNECTION="connection",a.POPUP_TRANSFER="[POPUP_TRANSFER]_connected",a.CONNECTED_NETWORK="[CONNECTED_NETWORK]",a.DEFAULT="message",a))(t0||{}),{APP_BSAFE_URL:Z0}=e0,X0=class{constructor(a){this.config=a,this.BSAFEAPP=Z0;}open(a){let{popup:e}=this.config;return window.open(`${this.BSAFEAPP}${a}${this.queryString}`,"popup",`left=${e.left},top=${e.top},width=${e.width},height=${e.height}`)}get queryString(){let{origin:a,name:e,sessionId:t}=this.config;return `?sessionId=${t}&name=${e}&origin=${a}`}},{API_URL:X,APP_NAME:Y0,APP_BSAFE_URL:Y,APP_IMAGE_DARK:ee,APP_DESCRIPTION:te,APP_IMAGE_LIGHT:ae}=e0,Er=class extends FuelConnector{constructor(){super(),this.name=Y0,this.metadata={image:{light:ae,dark:ee},install:{action:Y,link:Y,description:te}},this.installed=!0,this.connected=!1,this.events={...FuelConnectorEventTypes,...t0},this.api=G.create({baseURL:X});let a=localStorage.getItem("sessionId")||"";a||(a=crypto.randomUUID(),localStorage.setItem("sessionId",a)),this.sessionId=a,this.socket=io(X,{auth:{username:"[WALLET]",data:new Date,sessionId:this.sessionId,origin:window.origin}}),this.dAppWindow=new X0({sessionId:a,name:document.title,origin:window.origin,popup:{top:0,left:2560,width:450,height:1280}}),this.socket.on("message",e=>{this.emit(e.type,...e.data);});}async connect(){return new Promise(a=>{this.dAppWindow.open("/")?.addEventListener("close",()=>{a(!1);}),this.on("connection",e=>{this.connected=e,a(e);});})}async sendTransaction(a,e){return new Promise((t,s)=>{this.dAppWindow.open("/dapp/transaction")?.addEventListener("close",()=>{s("closed");}),this.on("[POPUP_TRANSFER]_connected",()=>{this.socket.emit("[TRANSACTION_SEND]",{to:`${this.sessionId}:${window.origin}`,content:{address:a,transaction:e}});}),this.on("[TRANSACTION_CREATED]",n=>{t(`0x${n}`);});})}async ping(){return !0}async version(){return {app:"0.0.1",network:">=0.12.4"}}async isConnected(){let{data:a}=await this.api.get(`/connections/${this.sessionId}/state`);return a}async accounts(){let{data:a}=await this.api.get(`/connections/${this.sessionId}/accounts`);return a}async currentAccount(){let{data:a}=await this.api.get(`/connections/${this.sessionId}/currentAccount`);return a}async disconnect(){return this.socket.emit("[AUTH_DISCONECT_DAPP]",{to:`${this.sessionId}:${window.origin}`,content:{sessionId:this.sessionId}}),this.emit("connection",!1),this.emit("accounts",[]),this.emit("currentAccount",null),!1}async currentNetwork(){let{data:a}=await this.api.get(`/connections/${this.sessionId}/currentNetwork`);return a}async assets(){return []}async signMessage(a,e){throw new Error("Method not implemented.")}async addAssets(a){throw new Error("Method not implemented.")}async addAsset(a){throw new Error("Method not implemented.")}async addNetwork(a){throw new Error("Method not implemented.")}async selectNetwork(a){throw new Error("Method not implemented.")}async networks(){throw new Error("Method not implemented.")}async addABI(a,e){throw new Error("Method not implemented.")}async getABI(a){throw new Error("Method not implemented.")}async hasABI(a){throw new Error("Method not implemented.")}};

export { x as Asset, k as AuthService, t0 as BSAFEConnectorEvents, D as BSAFEScriptTransaction, m0 as BSafe, Er as BSafeConnector, E as PredicateAbi__factory, h0 as SortOption, S0 as TransactionProcessStatus, L as TransactionStatus, C as Transfer, H as TransferInstanceError, O as Vault, T0 as WitnessStatus, v as accounts, ks as assetsList, T as defaultConfig, M as defaultValues, W as makeHashPredicate, j as makeSubscribers, ms as recoverSigner, K as transactionScript };
//# sourceMappingURL=out.js.map
//# sourceMappingURL=index.mjs.map
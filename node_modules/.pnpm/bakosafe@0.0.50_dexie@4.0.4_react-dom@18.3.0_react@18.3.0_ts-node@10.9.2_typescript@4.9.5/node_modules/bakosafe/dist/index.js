'use strict';

var $ = require('axios');
var fuels = require('fuels');
var uuid = require('uuid');
var socket_ioClient = require('socket.io-client');

function _interopDefault (e) { return e && e.__esModule ? e : { default: e }; }

var $__default = /*#__PURE__*/_interopDefault($);

var q=(e=>(e.FUEL="FUEL",e.WEB_AUTHN="WEB_AUTHN",e))(q||{});var v={PROVIDER:"http://localhost:4000/graphql",SERVER_URL:"http://localhost:3333/",CLIENT_URL:"https://safe.bako.global",ENCODER:"Fuel"},_={GAS_PRICE:1,GAS_LIMIT:1e4},f0=["ENCODER"],d={setup:a=>{Object.keys(a).forEach(e=>{e in v&&!f0.includes(e)&&(v[e]=a[e]);});},setChainConfig:a=>{Object.keys(a).forEach(e=>{e in _&&(_[e]=a[e]);});},get:a=>v[a],getChainConfig:a=>_[a]};var b={FULL:{account:"0x94ffcc53b892684acefaebc8a3d4a595e528a8cf664eeb3ef36f1020b0809d0d",address:"fuel1jnluc5acjf5y4nh6a0y28499jhjj32x0ve8wk0hndugzpvyqn5xsfsfzly",privateKey:"0xa449b1ffee0e2205fa924c6740cc48b3b473aa28587df6dab12abc245d1f5298"},STORE:{account:"0x53de37ae51fcfecb17ee3589f68904ac75bf5ec109edeb1065ccb63145287da6",address:"fuel1200r0tj3lnlvk9lwxkyldzgy436m7hkpp8k7kyr9ejmrz3fg0knqndhwm6",privateKey:"0x61a006b78a6e9eb5aeb11df25e6444be281893875ae5fdc5fa4a0f4702995cb7"},USER_1:{account:"0x92dffc873b56f219329ed03bb69bebe8c3d8b041088574882f7a6404f02e2f28",address:"fuel1jt0lepem2mepjv576qamdxltarpa3vzppzzhfzp00fjqfupw9u5q9gyphu",privateKey:"0xa349d39f614a3085b7f7f8cef63fd5189136924fc1238e6d25ccdaa43a901cd0"},USER_2:{account:"0x456bdaffaf74fe03521754ac445d148033c0c6acf7d593132c43f92fdbc7324c",address:"fuel1g44a4la0wnlqx5sh2jkyghg5sqeup34v7l2exyevg0ujlk78xfxqr6ywcm",privateKey:"0x139f2cd8db62a9d64c3ed4cdc804f1fb53be98d750cd1432a308b34a42d8dcc7"},USER_3:{account:"0x639880ece7753a32e09164d14dad7436c57737e567f18b98f6ee30fec6b247ec",address:"fuel1vwvgpm88w5ar9cy3vng5mtt5xmzhwdl9vlcchx8kacc0a34jglkqjnvpjz",privateKey:"0x40aaca08dac67fa0c22b51794f652e20173970cd05a8797f2d3e8393cfc44211"},USER_4:{account:"0xfd8c520ef8caff0ad3289aa64acecd4ef86ac8f643fd9b76bf2d163a86a66716",address:"fuel1lkx9yrhcetls45egn2ny4nkdfmux4j8kg07eka4l95tr4p4xvutqmvhl2l",privateKey:"0xb58ad4fb072290d03fc2d81cd7534e9bf7360ccad8a48d2799b60bab357255da"},USER_5:{account:"0x8247104854dd733cb475901d55047f57cb3c8cafe3a9f7233de3325b8bf56a5c",address:"fuel1sfr3qjz5m4enedr4jqw42prl2l9ner90uw5lwgeauve9hzl4dfwqxhyn83",privateKey:"0x4256a670740031e4e7cb7216c9fe8921a4485c187686b7ab0ae7c317d7de0a22"}};var f={ETH:"0x0000000000000000000000000000000000000000000000000000000000000000",DAI:"0x0d9be25f6bef5c945ce44db64b33da9235fbf1a9f690298698d899ad550abae1",sETH:"0x1bdeed96ee1e5eca0bd1d7eeeb51d03b0202c1faf764fec1b276ba27d5d61d89"},F={min:1e-4,1:1,2:2,3:3,5:5,10:10,100:100};fuels.bn.parseUnits(F.min.toString());var U=class a{constructor({address:t,token:e}){this.BakoSafeAuth={address:t,token:e},this.client=$__default.default.create({baseURL:d.get("SERVER_URL"),headers:{Authorization:e,Signeraddress:t}});}static async create(t,e){let r=b[t].address,s=b[t].privateKey,n=$__default.default.create({baseURL:d.get("SERVER_URL")}),{data:{code:o}}=await n.post("/user",{address:r,provider:e,type:"FUEL"});if(!o)throw new Error("Account not created");let{data:c}=await n.post("/auth/sign-in",{digest:o,encoder:"FUEL",signature:await a.signerByPk(s,o)});return new a({address:r,token:c.accessToken})}static async signerByPk(t,e){return await fuels.Wallet.fromPrivateKey(t,await fuels.Provider.create(d.get("PROVIDER"))).signMessage(e)}static async signerByAccount(t,e){return await t.signMessage(e)}async signTransaction(t,e,r){let{data:s}=await this.client.get(`/transaction/${e}`),n=await t.signMessage(s.hash);await this.client.put(`/transaction/signer/${e}`,{account:t.address.toString(),signer:n,confirm:r??!0}).then(()=>!0).catch(()=>!1);}};var T=class{constructor(t){this.client=$__default.default.create({baseURL:d.get("SERVER_URL"),headers:{Authorization:t.token,Signeraddress:t.address}});}};var I=class extends T{constructor(t){super(t);}async create(t){try{let{data:e}=await this.client.post("/transaction",t);return e}catch{throw new Error("ERRO AO CRIAR")}}async findByHash(t){let{data:e}=await this.client.get(`/transaction/by-hash/${t}`);return e}async findByTransactionID(t){let{data:e}=await this.client.get(`/transaction/${t}`);return e}async sign(t,e,r,s){let{data:n}=await this.client.put(`/transaction/signer/${t}`,{account:e,signer:r,confirm:s??!0});return n}async send(t){let{data:e}=await this.client.post(`/transaction/send/${t}`);return e}async verify(t){let{data:e}=await this.client.post(`/transaction/verify/${t}`);return e}};var W=(e=>(e.ASC="ASC",e.DESC="DESC",e))(W||{}),O=(o=>(o.AWAIT_REQUIREMENTS="await_requirements",o.PENDING_SENDER="pending_sender",o.PROCESS_ON_CHAIN="process_on_chain",o.SUCCESS="success",o.DECLINED="declined",o.FAILED="failed",o))(O||{}),I0=(r=>(r.REJECTED="REJECTED",r.DONE="DONE",r.PENDING="PENDING",r))(I0||{}),g0=(s=>(s.SUCCESS="SuccessStatus",s.SQUIZED="SqueezedOutStatus",s.SUBMITED="SubmittedStatus",s.FAILED="FailureStatus",s))(g0||{});var x=class extends T{constructor(t){super(t);}async create(t){let{data:e}=await this.client.post("/predicate",t);return e}async findByAddress(t){let{data:e}=await this.client.get(`/predicate/by-address/${t}`);return e}async findById(t){let{data:e}=await this.client.get(`/predicate/${t}`);return e}async hasReservedCoins(t){let{data:e}=await this.client.get(`/predicate/reserved-coins/${t}`);return e}async listPredicateTransactions(t){let{data:e}=await this.client.get("/transaction",{params:{...t}});return e}};var K={perPage:10,page:0,orderBy:"createdAt",sort:"DESC"};var h=class{static async assetsGroupById(t){return t.reduce((e,r)=>{let{assetId:s,amount:n}=r;return e[s]?e[s]=e[s].add(fuels.bn.parseUnits(n)):e[s]=fuels.bn.parseUnits(n),e},{})}static async assetsGroupByTo(t){return t.reduce((e,r)=>{let{to:s,amount:n,assetId:o}=r,c=`${s}${o}`;return e[c]?e[c].amount.add(fuels.bn.parseUnits(n)):e[c]={assetId:o,amount:fuels.bn.parseUnits(n),to:s},e},{})}static async addTransactionFee(t,e){let r=t;if(!!r[f.ETH]){let n=fuels.bn(e).add(r[f.ETH]);r[f.ETH]=n;}else r[f.ETH]=fuels.bn().add(e);return Object.entries(r).map(([n,o])=>({amount:o,assetId:n}))}static includeSpecificAmount(t,e){return e.map(r=>t.find(n=>n)?{...r}:{...r,onPredicate:""})}};var ke=[{name:"Etherum",slug:"ETH",assetId:f.ETH},{name:"Dai",slug:"DAI",assetId:f.DAI},{name:"sEther",slug:"sETH",assetId:f.sETH}];var L=(r=>(r.IS_OLD="IS_OLD",r.IS_NEW="IS_NEW",r.IS_SCRIPT="IS_SCRIPT",r))(L||{}),M=(e=>(e.REQUIRED_AUTH="Required credentials",e.INVALID_PARAMETER="Invalid instance parameters",e))(M||{});var j=a=>new Promise(t=>setTimeout(t,a));var w=class extends fuels.Provider{constructor(){super(d.get("PROVIDER"));}};fuels.Wallet.fromPrivateKey(b.FULL.privateKey,new w);({gasPrice:fuels.bn(d.getChainConfig("GAS_PRICE")),gasLimit:fuels.bn(d.getChainConfig("GAS_LIMIT"))});var G=(e=>(e.IS_OLD="IS_OLD",e.IS_NEW="IS_NEW",e))(G||{});var Q={signature:"0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",address:"0x0000000000000000000000000000000000000000000000000000000000000000"},Z=()=>fuels.Address.fromRandom().toB256(),Y=a=>{let t=Array(10).fill(fuels.ZeroBytes32);return a.forEach((e,r)=>{t[r]=fuels.Address.fromString(e).toB256();}),t},E0=async a=>{let{id:t,predicateAddress:e,token:r,address:s}=a,n="id"in a&&t;if(e==null&&t==null)throw new Error("predicateAddress or BakoSafePredicateId is required");let o=new x({address:s,token:r}),c=n?await o.findById(t):await o.findByAddress(e);if(!c)throw new Error("BakoSafeVault not found");return {configurable:JSON.parse(c.configurable),provider:await fuels.Provider.create(c.provider),name:c.name,description:c.description,abi:c.abi,bytecode:c.bytes,BakoSafeAuth:{address:s,token:r},BakoSafeVaultId:c.id,BakoSafeVault:c,api:o}},x0=a=>{if("BakoSafeAuth"in a&&a.BakoSafeAuth){let{address:e,token:r}=a.BakoSafeAuth;a.api=new x({address:e,token:r});}return a},w0=async a=>{let t=("predicateAddress"in a||"id"in a)&&"address"in a&&"token"in a;return {is:t,data:t?await E0(a):void 0}},C0=async a=>{let t="configurable"in a&&"provider"in a;return t&&k0(a.configurable),{is:t,data:t?x0(a):void 0}},k0=a=>{let{SIGNATURES_COUNT:t,SIGNERS:e}=a;if(!t||Number(t)==0)throw new Error("SIGNATURES_COUNT is required must be granter than zero");if(!e||e.length===0)throw new Error("SIGNERS must be greater than zero");if(e.length<Number(t))throw new Error("Required Signers must be less than signers")},X=async a=>{try{let{data:t,is:e}=await w0(a),{data:r}=await C0(a);return e&&t?{type:"IS_OLD",payload:t}:{type:"IS_NEW",payload:r}}catch(t){throw new Error(t.message)}};var B=class extends fuels.ScriptTransactionRequest{constructor({script:t,gasLimit:e,gasPrice:r}={script:e0,gasPrice:fuels.bn(d.getChainConfig("GAS_PRICE")),gasLimit:fuels.bn(d.getChainConfig("GAS_LIMIT"))}){super({gasPrice:r,gasLimit:e,script:t});}async instanceTransaction(t,e,r,s){Object.entries(r).map(([,n])=>{this.addCoinOutput(fuels.Address.fromString(n.to),n.amount,n.assetId);}),this.addResources(t),this.inputs?.forEach(n=>{n.type===fuels.InputType.Coin&&fuels.hexlify(n.owner)===e.address.toB256()&&(n.predicate=fuels.arrayify(e.bytes));}),s&&(this.witnesses=[...this.witnesses,...s]);}};var e0=fuels.arrayify("0x9000000447000000000000000000003c5dfcc00110fff3001a485000910000201a440000724000202849140072400020340004902400000047000000");function gr(a,t){if(t=="0x")return;let e=fuels.Signer.recoverAddress(fuels.hashMessage(t),a);return e?e.toString():Q.address}var s0=(a,t)=>fuels.transactionRequestify(a).getTransactionId(t).slice(2),n0=async({vault:a,assets:t,witnesses:e})=>{let r=await h.assetsGroupByTo(t),s=await h.assetsGroupById(t),n=await h.addTransactionFee(s,fuels.bn(d.getChainConfig("GAS_PRICE"))),o=await a.getResourcesToSpend(n),c=new B;return await c.instanceTransaction(o,a,r,e),c},L0=async({transfer:a,auth:t,vault:e})=>{let s=a&&Object.entries(a).length<=3&&Object.entries(a).length>0&&typeof a!="string"&&"assets"in a&&!!e;if(s){let{assets:n}=a,o=t&&new I(t),c=n.map(E=>({assetId:E.assetId,amount:E.amount.toString(),to:E.to})),u=`tx_${uuid.v4()}`,g=await n0({name:a.name?a.name:u,vault:e,assets:c}),p=fuels.transactionRequestify(g),A=s0(p,e.provider.getChainId()),l=t&&o&&await o.create({assets:c,hash:A,txData:p,name:a.name??u,status:"await_requirements",predicateAddress:e.address.toString()}),m={vault:e,service:o,BakoSafeTransaction:l,name:a.name??u,transactionRequest:p,BakoSafeScript:g,witnesses:[],BakoSafeTransactionId:l?.id};return {is:s,data:m}}return {is:s,data:void 0}},V0=async({transfer:a,auth:t,vault:e})=>{let r=typeof a=="string";if(r){if(!t)throw new Error("Required credentials");let s=new I(t),n=a.length<=36?await s.findByTransactionID(a):await s.findByHash(a),o=await n0({name:n.name,vault:e,assets:n.assets,witnesses:n.witnesses.map(u=>u.signature).filter(u=>!!u)}),c={vault:e,service:s,name:n.name,BakoSafeScript:o,transactionRequest:fuels.transactionRequestify(o),witnesses:n.witnesses.map(u=>u.account),BakoSafeTransactionId:n.id,BakoSafeTransaction:n};return {is:r,data:c}}return {is:r,data:void 0}},G0=async({transfer:a,auth:t,vault:e,isSave:r})=>{let s=a&&Object.entries(a).length>3&&typeof a!="string"&&"type"in a,n=`tx_${uuid.v4()}`,o=t&&new I(t);if(s){e.populateTransactionPredicateData(a);let c=fuels.transactionRequestify(a),u=s0(c,e.provider.getChainId()),g=c.getCoinOutputs().map(m=>({assetId:m.assetId.toString(),to:m.to.toString(),amount:fuels.bn(m.amount).format().toString()})),p;t&&o&&r&&(p=await o.create({assets:g,hash:u,txData:c,name:n,status:"await_requirements",predicateAddress:e.address.toString()}));let A=p&&p.witnesses?p.witnesses.map(m=>m.signature).filter(m=>!!m):[],l={vault:e,service:o,witnesses:A,name:n,transactionRequest:c,BakoSafeScript:new fuels.ScriptTransactionRequest,BakoSafeTransaction:p,BakoSafeTransactionId:p?.id};return {is:s,data:l}}return {is:s,data:void 0}},i0=async a=>{try{let{data:t,is:e}=await V0(a),{data:r,is:s}=await L0(a),{data:n,is:o}=await G0(a);return e&&t?{type:"IS_OLD",payload:t}:s&&r?{type:"IS_NEW",payload:r}:{type:"IS_SCRIPT",payload:n}}catch(t){throw new Error(t.message)}};var C=class a{constructor({vault:t,name:e,transactionRequest:r,BakoSafeScript:s,service:n,BakoSafeTransaction:o,BakoSafeTransactionId:c}){this.name=e,this.vault=t,this.service=n,this.witnesses=[],this.BakoSafeScript=s,this.transactionRequest=r,this.BakoSafeTransaction=o,this.BakoSafeTransactionId=c;}static async instance(t){let e=await i0(t);switch(e.type){case"IS_OLD":{let{payload:r}=e;return new a(r)}case"IS_NEW":{let{payload:r}=e;return new a(r)}case"IS_SCRIPT":{let{payload:r}=e;return new a(r)}default:throw new Error("Invalid param type to create a transfer")}}makeBlockUrl(t){return t?`https://fuellabs.github.io/block-explorer-v2/transaction/${this.getHashTxId()}?providerUrl=${encodeURIComponent(this.vault.provider.url)}`:""}getHashTxId(){return this.transactionRequest.getTransactionId(this.vault.provider.getChainId()).slice(2)}async send(){if(!this.service){let t=fuels.transactionRequestify(this.BakoSafeScript);t.witnesses=this.witnesses;let e=await this.vault.provider.estimatePredicates(t),r=fuels.hexlify(e.toTransactionBytes()),{submit:{id:s}}=await this.vault.provider.operations.submit({encodedTransaction:r});return new fuels.TransactionResponse(s,this.vault.provider)}switch(this.BakoSafeTransaction=await this.service.findByTransactionID(this.BakoSafeTransactionId),this.BakoSafeTransaction.status){case"pending_sender":await this.service.send(this.BakoSafeTransactionId);break;case"process_on_chain":return await this.wait();}return {...this.BakoSafeTransaction.resume,BakoSafeID:this.BakoSafeTransactionId}}async wait(){if(!this.service)throw Error("Implement this.");let t=await this.service.findByTransactionID(this.BakoSafeTransactionId);for(;t.status!=="success"&&t.status!=="failed";)await j(this.vault.transactionRecursiveTimeout),t=await this.service.findByTransactionID(this.BakoSafeTransactionId),t.status=="pending_sender"&&await this.send(),t.status=="process_on_chain"&&await this.service.verify(this.BakoSafeTransactionId);return {...t.resume,status:t.status}}};var N=class{static hex2string(t){return t.filter(e=>e!=f.ETH).map(e=>fuels.Address.fromB256(e).toString())}};var K0={types:[{typeId:0,type:"[_; 10]",components:[{name:"__array_element",type:1,typeArguments:null}],typeParameters:null},{typeId:1,type:"b256",components:null,typeParameters:null},{typeId:2,type:"bool",components:null,typeParameters:null},{typeId:3,type:"u64",components:null,typeParameters:null}],functions:[{inputs:[],name:"main",output:{name:"",type:2,typeArguments:null},attributes:null}],loggedTypes:[],messagesTypes:[],configurables:[{name:"SIGNERS",configurableType:{name:"",type:0,typeArguments:null},offset:5012},{name:"SIGNATURES_COUNT",configurableType:{name:"",type:3,typeArguments:null},offset:4996},{name:"HASH_PREDICATE",configurableType:{name:"",type:1,typeArguments:null},offset:4964}]},M0="0x740000034700000000000000000012fc5dfcc00110fff3001aec500091000f781a4000005d47f00a264400001a6870005047b87072480020284504805d43f00a286914005d43f00b264000001a6070001a6c00001a5000005d67f00b5d43f00a1641b400764002d16140000113450000764400061341004076400001360000005043ba901a401000740000025043ba901a400000134500007644000613410040764000025d43f00c36400000615c010574000001615c00075043bb785d47f03f1045130072480020284114805047bbd85d4bf03f10492300724c0020284524c0a1410460134100001a5800001a540000764002ad164165c0764000065d43f01115415400764000025d43f0111341540024400000614d64015043b6d072440090284134405d43b0da13410000764000e9614164015047b9501ae900001ae5100020f8330058fbe00250fbe0047400037e1a43d0005047be807248004028450480506bbe801a400000264000001a6c7000134140001a70000076400020134000007640001a107005001541c0007640000174000008267000001a4470001540000076400001740000021a4000002845b4001a6d10001a48000016412500764000031a400000264000007400000c1a4000001041b40010410480104584805c4510005e411000104920407500000b1a400000264000001a7140001a6d80005d43f040104103005d47f04010451300504bbe60724c0020284904c05043be604241b700504bbed0724c0020284904c05043bed0724800201b480480104bb480724c0020284914c0724800201b481480104bb480724c0020284914c05047b420724800402847b480504bbe00724c0040284914c05047be00504bb040724c00402849a4c0504fb6b072680020284d06803e4524c01a408000134100407640000a5043b5e85fec00bd5047be0050490008724c0040284914c0504bbae07244004828490440740000065043b3d85fec107b5fec0083504bbae072440048284904405043bd3872440048284124405043b76072440048284124405d43b15c13410040764000365043bd385047b81872480048284504805d43b1a71341000076400001360000005043b818504100085047bce872480040284504805043bce8724400201b440440104504405043bce8724800201b481480104904805043b4a0724c0020284114c050450020724c0020284524c05047ba4072480040284504805043b9b01ae910001ae5000020f8330058fbe00250fbe004740003061a43d0005047bc3872480020284504805043b5685fec00ad5047bc38504bb0c0724c0020284914c050450008724c0020284524c0504bbb2872440028284904407400000a5043b760504100405047b3a05fec107450491020724c0008284904c0504bbb2872400028284914005d43f041104103005047b7a8724c0028284524c05d47b16513451000504fbb5072480020284d048076440001740000095043b7a8504100085047bd8072480020284504805043bd80504fbb5072440020284d04405043be4072440020284134405043be401a6c00005d47f0121645b4401a48000076440001740000135047b2605d4bf04210492300724c0140284524c0724800201b49b480104914805047bbb8724c0020284504c0504fbc1872680020284d2680a14514e01a48100076440002106db04075000016105554805043bb70740001b35043b6d0504100085047bef072480088284504805d43f03b104134005d47b1e6504bb8b01ae900001ae510001ae1200020f8330058fbe00250fbe004740002031a47d000504bbd28724c0010284914c05047bd28504bb630724c0010284914c05d692001504bb640724c0010284914c05d6d20005d47b1e61b441440104504405d4bb1e7504fb8c01ae910001ae520001ae1300020f8330058fbe00250fbe004740001ea1a47d000504bbec0724c0010284914c05047bec0504bb650724c0010284914c05d712001504bb660724c0010284914c05d7520005d47b1e61b441440104104405d47b1e71b441440104104405d47b1e8504bb8d01ae900001ae510001ae1200020f8330058fbe00250fbe004740001ce1a43d0005047bc5872480010284504805043bc585047b67072480010284504805d7910015047b68072480010284504805d7d10005043b9201ae9000020f8330058fbe00250fbe0047400022b1a43d0005d8100005d4500015d8500021341a00076400021134210007640001a10421680154904407648000174000007264000001a487000154d1000764c000174000001284a04401a8120001a4c000016453680764400051a440000264400001a8500001a4500007400000c10460840104514c01049b4c05c4920005e452000104d30407500000c1a400000264000001a85a0001a45a0001a81b0001341400076400021134210007640001a10421500154904407648000174000007264000001a487000154d1000764c000174000001284a04401a8120001a4c000016453500764400051a440000264400001a8500001a4500007400000c10460840104514c0104984c05c4920005e452000104d30407500000c1a400000264000001a8540001a4590001a8180001341c00076400021134210007640001a10421700154904407648000174000007264000001a487000154d1000764c000174000001284a04401a8120001a4c000016453700764400051a440000264400001a8500001a4500007400000c10460840104514c01049d4c05c4920005e452000104d30407500000c1a400000264000001a85c0001a45c0001a81d0005043b9d05fee013a5fed113b5fee113c5047b8e01ae900001ae5100020f8330058fbe00250fbe004740001611a43d0005047bc6872480020284504805043b9381ae9000020f8330058fbe00250fbe004740001a91a43d0005d6900005d7100015d6d00021341e000764000211341b0007640001a1041b780154507007644000174000007264000001a4470001549c00076480001740000012845a7001a6910001a4c000016453780764400051a440000264400001a6d00001a7100007400000c1045a6c0104514c01049f4c05c4920005e452000104d30407500000c1a400000264000001a6de0001a71e0001a69f0005043bc685d47f00a264400001a447000504bb890724c0020284904c05d43f00a284524005d43f00a13410000764000231341b0007640001c5d43f00a1041b400154907007648000174000007264000001a487000154dc000764c0001740000012849a7001a6920001a7000005d4bf00a1649c480764800051a440000264400001a6d00001a7100007400000c1049a6c010492700104d17005c4d30005e4930001071c0407500000d1a400000264000005d6ff00a5d73f00a1a6910005d43f040104103005047b9e85feda13d5fedc13e5fedb13f504bb9001ae910001ae5200020f8330058fbe00250fbe004740000f41a47d000504bbc88724c0020284914c05047bef0504bbc88504fb080726800201b68068010693680726c0020286906c0726800201b68168010693680726c0020286906c05043b4607268004028413680504fbdc072680040284d06805043bdc0504fb0e072680040284d16805047b69072680020284526803f4134401a408000134100407640000a5043b5a05fec00b45047bdc050490008724c0040284914c0504bba987244004828490440740000065043b4e05fec109c5fec00a4504bba9872440048284904405043b7d072440048284124405d43b1531341000076400001360000005043b7d0504100085047bca872480040284504805043bca8724400201b440440104504405043bca8724800201b481480104904805043b528724c0020284114c050450020724c0020284524c05047ba0072480040284504805043b9901ae910001ae5000020f8330058fbe00250fbe004740001231a43d0005047bda072480020284504805043bda01a6c00005d47f0121645b4401a48000076440001740000135047b1205d4bf04210492300724c0140284524c0724800201b49b480104914805047bb98724c0020284504c0504fbbf872680020284d2680a14514e01a48100076440002106db04075000016105554805043bb7010596040750002ab240000005d43f00a164106c0764000025d43f00a134106c07640000a1041a6c05047b5905fec10b25c4100005049100f5e490000504bba807240001028491400740000055043b3c85fec0079504bba8072440010284904405043b86072440010284124405d43b1501341004076400001360000005043b8605041000f5c4100005d47f043104513005d4bf03c1f490480724c00011b4924c0104914805c452000134946407648000174000010134990001a4c1000764800025d4bf03d1b4d2640154936407648000174000007264c00001a487000155590007654000174000001284986401a6120001a653000104985005e491000104540405d4bf043104923005c4ff1f0114104c0724c00011b4104c0104124005c410000134916407648000174000010134990001a4c1000764800025d4bf03d1b4d2640154936407648000174000007264c00001a487000155190007650000174000001284986401a6120001a653000104984405e49000010511040106db0407500032f1af05000910000285ff100005ff110015ff120025ff130035ff3b0041aec5000910000101a43a0001a4790001a4b80001a4fe0001b4510405fed00005fed10011a43b00072440010284904401af52000920000101af9300059f050285d43c0005d47c0015d4bc0025d4fc0035defc004920000284af800001af05000910000505ff100005ff110015ff120025ff130035ff140045ff150055ff160065ff170075ff180085ff3b0091aec5000910000201a43a0001a4790001a4be0001a4c0000264c00001a4c70005d5100005d5500025d410002134100001a58000076400020134000007640001a10580540154160007640000174000008265800001a407000155c0000765c0001740000021a5c0000284135c01a4d00001a60000016418540764000031a400000264000007400000c1a4000001041340010410600105d46005c5d70005e417000106180407500000b1a400000264000001a5950001a4d40005d43f040104103007250002028ed05001a43b00042413580724c0020284504c01af51000920000201af9200059f050505d43c0005d47c0015d4bc0025d4fc0035d53c0045d57c0055d5bc0065d5fc0075d63c0085defc009920000504af800001af05000910000205ff100005ff110015ff120025ff3b0031aec5000910000001a43a0001a47e0001a480000264800001a4870005f4120005f4000015f4000021af50000920000001af9100059f050205d43c0005d47c0015d4bc0025defc003920000204af800001af05000910000285ff100005ff110015ff120025ff130035ff3b0041aec5000910000001a43a0001a4790001a4be000724c0040284504c01af51000920000001af9200059f050285d43c0005d47c0015d4bc0025d4fc0035defc004920000284af800001af05000910000385ff100005ff110015ff120025ff130035ff140045ff150055ff3b0061aec5000910000781a43a0001a4b90001a4fe0005d47f040104513001a500000265000001a5070005fed40085fec00095fec000a5053b0407254004028ed05401aebb0001ae5400020f8330058fbe00250fbe004740000165043b05872500020284115005053b0585d43b0085d47b00a4251044072400020284944001af52000920000781af9300059f050385d43c0005d47c0015d4bc0025d4fc0035d53c0045d57c0055defc006920000384af800001af05000910000585ff100005ff110015ff120025ff130035ff140045ff150055ff160065ff170075ff180085ff190095ff3b00a1aec5000910000401a43a0001a6790001a63e0005d47f00a264400001a4470007248002028ed04801a4bb0005d4d20005d5120015d5520025d4920035f4530005f4540015f4550025f4520035d4bf00a134920007648002c5d49900213492000764800225d4990025d4ff00a104924c05d4d90025d5190005d559001155925407658000174000007264800001a587000155d5000765c000174000001285945401a5160005f6540001a5800005d53f00a16516500765000055f6520015f6520021a440000264400007400000f5d519000105144c010514580105515805c5550005e515000105960407500000e5f6510005d47f00a5f6510015d47f00a5f6510021a44000026440000504100205d47f00a264400001a447000504bb020724c0020284904c05d4120005d4d20015d5120025d4920035f4500005f4530015f4540025f4520035d43f00a134100007640002c5d41900213410000764000225d4190025d4bf00a104104805d4990025d4d90005d519001155505007654000174000007264000001a547000155940007658000174000001285535001a4d50005f6530001a5400005d4ff00a164d54c0764c00055f6500015f6500021a400000264000007400000f5d4d9000104d3480104d3540105115405c5140005e4d4000105550407500000e5f6510005d43f00a5f6500015d43f00a5f6500021a400000264000001af40000920000401af9800059f050585d43c0005d47c0015d4bc0025d4fc0035d53c0045d57c0055d5bc0065d5fc0075d63c0085d67c0095defc00a920000584af8000047000000111111111111111111111111111111111111111111111111111111111111111100000000000000000000000000000000000000000000000000000000000000003031323334353637383961626364656600000000000000200000000000000040cccccccccccc000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060000000000000000400000000000000020f000000000000000000000000001364000000000000131c00000000000012fc0000000000001394000000000000133c",k=class k{static createInstance(t,e){let{abi:r,bin:s}=k;return new fuels.Predicate(s,t,r,e)}};k.abi=K0,k.bin=M0;var y=k;var V=class a extends fuels.Predicate{constructor({configurable:t,provider:e,abi:r=y.abi,bytecode:s=y.bin,name:n,description:o,BakoSafeVaultId:c,BakoSafeVault:u,BakoSafeAuth:g,transactionRecursiveTimeout:p=1e3,api:A}){let l=typeof r=="string"?JSON.parse(r):r,m=s,{network:E,chainId:d0}=t,P=a.makePredicate(t);super(fuels.arrayify(m),e,l,P),this.bin=m,this.abi=l,this.configurable={HASH_PREDICATE:P.HASH_PREDICATE,SIGNATURES_COUNT:P.SIGNATURES_COUNT,SIGNERS:P.SIGNERS,network:E,chainId:d0},this.provider=e,this.name=n||`Vault - ${uuid.v4()}`,this.description=o,this.BakoSafeVaultId=c,this.transactionRecursiveTimeout=p,this.BakoSafeVault=u,this.auth=g,this.api=A;}static async create(t){let e=await X(t);switch(e.type){case"IS_OLD":return new a(e.payload);case"IS_NEW":let r=new a(e.payload);return r.api&&await r.createOnService(),r;default:throw new Error("Invalid param type to create a vault")}}verifyAuth(){if(!this.auth)throw new Error("Auth is required")}async createOnService(){this.verifyAuth();let{id:t,...e}=await this.api.create({name:this.name,description:this.description,predicateAddress:this.address.toString(),minSigners:this.configurable.SIGNATURES_COUNT,addresses:N.hex2string(this.configurable.SIGNERS),bytes:this.bin,abi:JSON.stringify(this.abi),configurable:JSON.stringify(this.configurable),provider:this.provider.url});this.BakoSafeVault={...e,id:t},this.BakoSafeVaultId=t;}static makePredicate(t){return {SIGNATURES_COUNT:t.SIGNATURES_COUNT,SIGNERS:Y(t.SIGNERS),HASH_PREDICATE:t.HASH_PREDICATE??Z()}}async BakoSafeIncludeTransaction(t){return C.instance({auth:this.auth,vault:this,transfer:t,isSave:!0})}async BakoSafeGetTransactions(t){return this.verifyAuth(),await this.api.listPredicateTransactions({predicateId:[this.BakoSafeVaultId],...t??K}).then(r=>({...r,data:r.data.map(s=>({resume:s.resume,witnesses:s.witnesses}))}))}async BakoSafeGetTransaction(t){return C.instance({vault:this,auth:this.auth,transfer:t})}getAbi(){return this.abi}getBin(){return this.bin}getConfigurable(){return this.configurable}};var c0=(a=>(a.ACCOUNTS="accounts",a.CURRENT_ACCOUNT="currentAccount",a.TRANSACTION_CREATED="[TRANSACTION_CREATED]",a.TRANSACTION_SEND="[TRANSACTION_SEND]",a.AUTH_CONFIRMED="[AUTH_CONFIRMED]",a.AUTH_REJECTED="[AUTH_REJECTED]",a.AUTH_DISCONECT_DAPP="[AUTH_DISCONECT_DAPP]",a.AUTH_DISCONECT_CONFIRM="[AUTH_DISCONECT_CONFIRM]",a.CONNECTION="connection",a.POPUP_TRANSFER="[POPUP_TRANSFER]_connected",a.CONNECTED_NETWORK="[CONNECTED_NETWORK]",a.DEFAULT="message",a))(c0||{}),tt="Bako Safe",et="Bako Safe is a connector to safe.bako.global, a non-custodial vault for your crypto assets.",at="https://safe.bako.global/BAKO_CONNECTOR_ICON.svg",rt="https://safe.bako.global/BAKO_CONNECTOR_ICON.svg",H="https://safe.bako.global",o0="https://api-safe.bako.global",st=class{constructor(a){this.config=a,this.BSAFEAPP=H;}open(a){let{popup:t}=this.config;return window.open(`${this.BSAFEAPP}${a}${this.queryString}`,"popup",`left=${t.left},top=${t.top},width=${t.width},height=${t.height}`)}get queryString(){let{origin:a,name:t,sessionId:e}=this.config;return `?sessionId=${e}&name=${t}&origin=${a}`}},Vs=class extends fuels.FuelConnector{constructor(){super(),this.name=tt,this.metadata={image:{light:rt,dark:at},install:{action:H,link:H,description:et}},this.installed=!0,this.connected=!1,this.events={...fuels.FuelConnectorEventTypes,...c0},this.api=$__default.default.create({baseURL:o0});let a=localStorage.getItem("sessionId")||"";a||(a=crypto.randomUUID(),localStorage.setItem("sessionId",a)),this.sessionId=a,this.socket=socket_ioClient.io(o0,{auth:{username:"[WALLET]",data:new Date,sessionId:this.sessionId,origin:window.origin}}),this.dAppWindow=new st({sessionId:a,name:document.title,origin:window.origin,popup:{top:0,left:2560,width:450,height:1280}}),this.socket.on("message",t=>{this.emit(t.type,...t.data);});}async connect(){return new Promise(a=>{this.dAppWindow.open("/")?.addEventListener("close",()=>{a(!1);}),this.on("connection",t=>{this.connected=t,a(t);});})}async sendTransaction(a,t){return new Promise((e,r)=>{this.dAppWindow.open("/dapp/transaction")?.addEventListener("close",()=>{r("closed");}),this.on("[POPUP_TRANSFER]_connected",()=>{this.socket.emit("[TRANSACTION_SEND]",{to:`${this.sessionId}:${window.origin}`,content:{address:a,transaction:t}});}),this.on("[TRANSACTION_CREATED]",s=>{e(`0x${s}`);});})}async ping(){return !0}async version(){return {app:"0.0.1",network:">=0.12.4"}}async isConnected(){let{data:a}=await this.api.get(`/connections/${this.sessionId}/state`);return a}async accounts(){let{data:a}=await this.api.get(`/connections/${this.sessionId}/accounts`);return a}async currentAccount(){let{data:a}=await this.api.get(`/connections/${this.sessionId}/currentAccount`);return a}async disconnect(){return this.socket.emit("[AUTH_DISCONECT_DAPP]",{to:`${this.sessionId}:${window.origin}`,content:{sessionId:this.sessionId}}),this.emit("connection",!1),this.emit("accounts",[]),this.emit("currentAccount",null),!1}async currentNetwork(){let{data:a}=await this.api.get(`/connections/${this.sessionId}/currentNetwork`);return a}async assets(){return []}async signMessage(a,t){throw new Error("Method not implemented.")}async addAssets(a){throw new Error("Method not implemented.")}async addAsset(a){throw new Error("Method not implemented.")}async addNetwork(a){throw new Error("Method not implemented.")}async selectNetwork(a){throw new Error("Method not implemented.")}async networks(){throw new Error("Method not implemented.")}async addABI(a,t){throw new Error("Method not implemented.")}async getABI(a){throw new Error("Method not implemented.")}async hasABI(a){throw new Error("Method not implemented.")}};

exports.AddressUtils = N;
exports.Asset = h;
exports.AuthService = U;
exports.BakoSafe = d;
exports.BakoSafeConnector = Vs;
exports.BakoSafeConnectors = c0;
exports.BakoSafeScriptTransaction = B;
exports.ECreationTransactiontype = L;
exports.ECreationtype = G;
exports.PredicateService = x;
exports.SortOption = W;
exports.TransactionProcessStatus = g0;
exports.TransactionService = I;
exports.TransactionStatus = O;
exports.Transfer = C;
exports.TransferInstanceError = M;
exports.TypeUser = q;
exports.Vault = V;
exports.WitnessStatus = I0;
exports.accounts = b;
exports.assetsList = ke;
exports.defaultConfig = v;
exports.defaultListParams = K;
exports.defaultValues = Q;
exports.formatTransaction = n0;
exports.gasConfig = _;
exports.getHashTxId = s0;
exports.identifyCreateTransactionParams = i0;
exports.identifyCreateVaultParams = X;
exports.instanceByNewUtil = x0;
exports.instanceByOldUtil = E0;
exports.isNewPredicate = C0;
exports.isNewTransaction = L0;
exports.isNewTransactionByScript = G0;
exports.isOldPredicate = w0;
exports.isOldTransaction = V0;
exports.makeHashPredicate = Z;
exports.makeSubscribers = Y;
exports.recoverSigner = gr;
exports.transactionScript = e0;
exports.validations = k0;
//# sourceMappingURL=out.js.map
//# sourceMappingURL=index.js.map